% cv.sty
\ProvidesPackage{cv}

% define colors
\RequirePackage{xcolor}
\definecolor{accent}{HTML}{245998}
\definecolor{white}{HTML}{FFFFFF}
\definecolor{black}{HTML}{000000}

\lightercolor{accent}{25}{lightaccent}
\lightercolor{accent}{50}{darkaccent}
\lightercolor{black}{50}{halfblack}

% set paragraph indent, skip to zero
\setlength{\parindent}{0pt}
\setlength{\parskip}{0pt}
\setlength{\baselineskip}{0pt}

% set up hypperef links
\hypersetup{
    colorlinks,
    breaklinks,
    urlcolor=accent,
    linkcolor=accent,
}

% todo: underline all links (but not the chain icon)
% \makeatletter
% \patchcmd{\hyper@link@}
%   {{\Hy@tempb}{#4}}
%   {{\Hy@tempb}{\underline{#4}}}
%   {}{}
% \makeatother

% style section headings
\RequirePackage{titlesec}
\RequirePackage{multicol}
\RequirePackage{multirow}
% \titleformat{⟨command⟩}[⟨shape⟩]{⟨format⟩}{⟨label⟩}{⟨sep⟩}{⟨before-code⟩}[⟨after-code⟩]
\titleformat{\section}[block]{\color{accent}\large\scshape\raggedright}{}{0em}{}[\titlerule]

% Subsection headings style
\titleformat{\subsection}[block]
  {\color{accent}\normalsize\itshape\scshape\raggedright} % format: italic, same accent color
  {} % no label
  {0em} % separation
  {} % before-code
  [] % after-code (no rule)

\titlespacing{\section}{0pt}{2pt}{\defaultvspacing} % left, before, after

\titlespacing*{\subsection}{0pt}{0pt}{0.75\defaultvspacing} % removes almost all extra space

% bibliography spacing
\setlength{\bibitemsep}{0.75ex} % spacing between items
\setlength{\bibhang}{1.5em}               % hanging indent
\setlength{\bibinitsep}{0pt}
\setlength{\bibparsep}{0pt}

\defbibenvironment{bibliography}
  {\list
     {}
     {
      \setlength{\leftmargin}{\bibhang}   % hanging indent
    %   \setlength{\itemindent}{-\bibhang} % negative first line
      \setlength{\itemsep}{\bibitemsep}  % space between items
      \setlength{\parsep}{\bibparsep}
      \setlength{\topsep}{0pt}           % remove extra space above
      \setlength{\partopsep}{0pt}       % remove extra space above
      \setlength{\parskip}{0pt}         % remove extra space after
     }
  }
  {\endlist\vspace{\defaultvspacing}}
  {\item}

% add space before printbibliography text
\renewcommand{\bibsetup}{}

% make it so that unpublished bib entries are treated as misc
\DeclareBibliographyAlias{unpublished}{misc}

\DeclareSourcemap{
  \maps{
    \map{
      \step[typesource=unpublished, typetarget=misc]
    }
  }
}

% fields that you don't want shown in the references
\AtEveryBibitem{
    \clearlist{address}
    % \clearfield{date}
    \clearfield{eprint}
    %  \clearfield{isbn}
    %  \clearfield{issn}
    % \clearlist{location}
    % \clearfield{month}
    \clearfield{series}
    \clearlist{language}
    \clearfield{issue}
    %  all three of these must be included to remove (visited on ...)
    \clearfield{urldate}
    \clearfield{urlyear}
    \clearfield{urlmonth}
}